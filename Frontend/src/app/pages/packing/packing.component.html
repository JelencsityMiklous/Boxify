<p-toast position="bottom-right"></p-toast>
    <div class="page-wrapper">
      <div class="page-header">
        <div>
          <div class="page-title"> Pakol√°s</div>
          <div class="page-sub muted">V√°lassz t√°rgyat, a rendszer aj√°nl dobozt</div>
        </div>
      </div>

      <div class="packing-layout">
        <div class="packing-left">
          <!-- STEP 1 -->
          <div class="bx-card" style="margin-bottom:16px;">
            <div class="step-header">
              <div class="step-num">1</div>
              <div class="step-title">T√°rgy kiv√°laszt√°sa</div>
            </div>
            <div class="bx-card-body">
              <select class="big-select" [(ngModel)]="selectedItemId" (change)="onItemSelect()">
                <option value="">‚Äì V√°lassz t√°rgyat ‚Äì</option>
                <option *ngFor="let i of items" [value]="i.id">{{ getCatEmoji(i.category) }} {{ i.name }}</option>
              </select>

              <div class="qty-row">
                <span class="muted" style="font-size:13px;">Mennyis√©g:</span>
                <button class="qty-btn" (click)="decQty()">‚àí</button>
                <span class="qty-val mono">{{ qty }}</span>
                <button class="qty-btn" (click)="incQty()">+</button>
              </div>

              <div class="item-preview" *ngIf="selectedItem">
                <div style="font-weight:600;margin-bottom:6px;">{{ getCatEmoji(selectedItem.category) }} {{ selectedItem.name }}</div>
                <div class="muted mono" style="font-size:11px;">
                  {{ selectedItem.lengthCm }}√ó{{ selectedItem.widthCm }}√ó{{ selectedItem.heightCm }} cm &nbsp;¬∑&nbsp;
                  {{ selectedItem.weightKg }} kg &nbsp;¬∑&nbsp;
                  {{ selectedItem.category || 'Egy√©b' }}
                  <span *ngIf="selectedItem.box" style="color:var(--accent3)"> ¬∑ jelenleg: {{ selectedItem.box.code }}</span>
                </div>
              </div>

              <div *ngIf="fitResult" class="fit-check" [class]="fitResult.ok ? 'ok' : 'err'">
                <span class="fit-icon">{{ fitResult.ok ? '‚úÖ' : '‚ùå' }}</span>
                <div>
                  <div *ngIf="fitResult.ok">Elf√©r a kiv√°lasztott dobozban!</div>
                  <div *ngIf="!fitResult.ok">
                    <strong>Nem f√©r be:</strong>
                    <div *ngFor="let r of fitResult.reasons" style="font-size:12px;margin-top:4px;">‚Ä¢ {{ r.message }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div class="bx-card">
            <div class="step-header">
              <div class="step-num">2</div>
              <div class="step-title">Doboz kiv√°laszt√°sa</div>
            </div>
            <div class="bx-card-body">
              <select class="big-select" [(ngModel)]="selectedBoxId" (change)="onBoxSelect()">
                <option value="">‚Äì V√°lassz dobozt ‚Äì</option>
                <option *ngFor="let b of boxes" [value]="b.id">[{{ b.code }}] {{ b.name }}</option>
              </select>
              <button pButton label=" Bepakol√°s!" style="width:100%;justify-content:center;margin-top:12px;" (click)="doPack()" [loading]="packing" [disabled]="!selectedItemId || !selectedBoxId"></button>
            </div>
          </div>
        </div>

        <!-- RECOMMENDATIONS -->
        <div class="bx-card">
          <div class="step-header">
            <div class="step-num" style="background:var(--surface2);color:var(--text);">üí°</div>
            <div class="step-title">Aj√°nlott dobozok</div>
          </div>
          <div class="bx-card-body">
            <div *ngIf="!selectedItemId" class="empty-state">
              <div style="font-size:32px;margin-bottom:10px;">üì¶</div>
              <div>V√°lassz t√°rgyat az aj√°nl√°shoz</div>
            </div>
            <div *ngIf="selectedItemId && !recommendations.length && !loadingRec" class="empty-state">
              <div style="font-size:32px;margin-bottom:10px;">‚ö†Ô∏è</div>
              <div>Egyik dobozba sem f√©r el. Adj hozz√° nagyobb dobozt!</div>
            </div>
            <div *ngIf="loadingRec" class="empty-state">Keres√©s‚Ä¶</div>

            <div class="recommend-list">
              <div class="rec-item" *ngFor="let r of recommendations; let i = index"
                   [class.selected]="selectedBoxId === r.box.id"
                   (click)="selectRec(r)">
                <div class="rec-left">
                  <div class="box-code-badge">{{ r.box.code }}</div>
                  <div style="font-size:13px;font-weight:500;margin-top:6px;">{{ r.box.name }}</div>
                  <div class="muted" style="font-size:11px;">üìç {{ r.box.location || '‚Äì' }}</div>
                </div>
                <div class="rec-right">
                  <div class="muted mono" style="font-size:11px;margin-bottom:4px;">{{ r.fill.volumeFillPercent }}% teli</div>
                  <span class="rec-tag" [class]="i === 0 ? 'best' : 'good'">{{ i === 0 ? 'Aj√°nlott' : 'OK' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  